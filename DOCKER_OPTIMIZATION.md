# üê≥ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Docker –¥–ª—è ML-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

## üìä **–†–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –æ–±—Ä–∞–∑–æ–≤**

### ‚úÖ **–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è RAG-—Å–∏—Å—Ç–µ–º—ã:**
- **Admin Panel**: ~9GB (–≤–∫–ª—é—á–∞–µ—Ç sentence-transformers + –º–æ–¥–µ–ª–∏)
- **Telegram Bot**: ~9GB (—Ç–∞ –∂–µ –±–∞–∑–∞)
- **PostgreSQL**: ~600MB
- **Redis**: ~60MB

**–ò—Ç–æ–≥–æ: ~19GB** - —ç—Ç–æ **–ù–û–†–ú–ê–õ–¨–ù–û** –¥–ª—è ML-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!

## üéØ **–ü–æ—á–µ–º—É –æ–±—Ä–∞–∑—ã –±–æ–ª—å—à–∏–µ?**

### **sentence-transformers –≤–∫–ª—é—á–∞–µ—Ç:**
- –ú–æ–¥–µ–ª—å `ai-forever/sbert_large_nlu_ru`: ~1.5GB
- PyTorch: ~2GB
- Transformers –±–∏–±–ª–∏–æ—Ç–µ–∫–∞: ~500MB
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: ~1GB

**–≠—Ç–æ –ù–ï–û–ë–•–û–î–ò–ú–û –¥–ª—è RAG —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞!**

## üöÄ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏**

### 1. **Multi-stage build**
```dockerfile
FROM python:3.11-slim as builder
# –°–±–æ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

FROM python:3.11-slim
# –¢–æ–ª—å–∫–æ runtime
```

### 2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π**
```yaml
volumes:
  - ml_models_cache:/app/models_cache
environment:
  - TRANSFORMERS_CACHE=/app/models_cache
```

### 3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**
```yaml
deploy:
  resources:
    limits:
      memory: 2G
      cpus: '1.0'
```

### 4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
- –£–±—Ä–∞–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏

## üí° **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞**

### **1. –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤**
```bash
# –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ
docker system prune -a --volumes -f

# –£–¥–∞–ª—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -a -f
```

### **2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .dockerignore**
```
*.md
.git/
__pycache__/
*.log
```

### **3. –°–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**
```bash
# –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
docker-compose build admin-panel

# –¢–æ–ª—å–∫–æ –±–æ—Ç
docker-compose build telegram-bot
```

## üìà **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ**

### **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- **RAM**: 8GB (–¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
- **–î–∏—Å–∫**: 30GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **CPU**: 4 —è–¥—Ä–∞

### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:**
- **RAM**: 16GB
- **–î–∏—Å–∫**: 50GB SSD
- **CPU**: 8 —è–¥–µ—Ä

## üîß **–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤:**
```bash
# –†–∞–∑–º–µ—Ä—ã –æ–±—Ä–∞–∑–æ–≤
docker images

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
docker system df

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
docker system df -v
```

### **–û—á–∏—Å—Ç–∫–∞:**
```bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–û–°–¢–û–†–û–ñ–ù–û!)
docker system prune -a --volumes -f

# –¢–æ–ª—å–∫–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -a -f

# –¢–æ–ª—å–∫–æ build cache
docker builder prune -f
```

## üéØ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞**

### **1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Registry**
```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω —Ä–∞–∑
docker-compose build

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤ registry
docker tag poliom-admin-panel:latest your-registry/admin-panel:v1.0
docker push your-registry/admin-panel:v1.0
```

### **2. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π**
```dockerfile
# –í Dockerfile –¥–æ–±–∞–≤—å—Ç–µ
RUN python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('ai-forever/sbert_large_nlu_ru')"
```

### **3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ bind mounts –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**
```yaml
volumes:
  - ./services/admin-panel:/app:ro  # Read-only
```

## ‚úÖ **–ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

### **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
1. **–°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã –æ–¥–∏–Ω —Ä–∞–∑**: `docker-compose build`
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ volumes –¥–ª—è –¥–∞–Ω–Ω—ã—Ö**
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ**: `docker system prune -f`

### **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Registry**
2. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –º–æ–¥–µ–ª–∏ –≤ –æ–±—Ä–∞–∑**
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**

## üö® **–í–ê–ñ–ù–û: –ù–ï –£–î–ê–õ–Ø–ô–¢–ï**

**sentence-transformers** - —ç—Ç–æ –Ø–î–†–û RAG —Å–∏—Å—Ç–µ–º—ã!
–ë–µ–∑ –Ω–µ–≥–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–º–æ–∂–µ—Ç:
- –°–æ–∑–¥–∞–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ò—Å–∫–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**9GB –æ–±—Ä–∞–∑ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è ML-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!** 