#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –µ–¥–∏–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –∑–∞—Ä–ø–ª–∞—Ç–µ
"""

import os
import sys
from dotenv import load_dotenv

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ shared –º–æ–¥—É–ª—è–º
sys.path.append(os.path.join(os.path.dirname(__file__), '..', 'shared'))

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ handlers
from bot.handlers import extract_key_information, extract_specific_data_patterns, create_direct_answer, create_main_keyboard

def test_unified_salary_responses():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –∑–∞—Ä–ø–ª–∞—Ç–µ"""
    print("üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –µ–¥–∏–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ –∑–∞—Ä–ø–ª–∞—Ç–µ:")
    print("=" * 70)
    
    # –†–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –∑–∞—Ä–ø–ª–∞—Ç–µ
    salary_questions = [
        "–ó–∞—Ä–ø–ª–∞—Ç–∞",
        "–î–∞—Ç—ã –∑–∞—Ä–ø–ª–∞—Ç", 
        "–ö–æ–≥–¥–∞ –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –∑–∞—Ä–ø–ª–∞—Ç–∞",
        "–î–∞—Ç–∞ –≤—ã–ø–ª–∞—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã",
        "–ö–æ–≥–¥–∞ —è –ø–æ–ª—É—á–∞—é –¥–µ–Ω—å–≥–∏",
        "–í—ã–ø–ª–∞—Ç–∞ –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã",
        "–°—Ä–æ–∫–∏ –≤—ã–ø–ª–∞—Ç"
    ]
    
    expected_response = """üí∞ **–í—ã–ø–ª–∞—Ç–∞ –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã:**

–°–æ–≥–ª–∞—Å–Ω–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º:
‚Ä¢ –ó–∞—Ä–∞–±–æ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞ –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è **–¥–≤–∞ —Ä–∞–∑–∞ –≤ –º–µ—Å—è—Ü**
‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–Ω—è–º–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ —Å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è **12-–µ** –∏ **27-–µ** —á–∏—Å–ª–∞ –º–µ—Å—è—Ü–∞
‚Ä¢ –ü—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Å –≤—ã—Ö–æ–¥–Ω—ã–º–∏/–ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏ –≤—ã–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞–∫–∞–Ω—É–Ω–µ

*–ò—Å—Ç–æ—á–Ω–∏–∫–∏: –ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ–± –æ–ø–ª–∞—Ç–µ —Ç—Ä—É–¥–∞, –ü—Ä–∞–≤–∏–ª–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ç—Ä—É–¥–æ–≤–æ–≥–æ —Ä–∞—Å–ø–æ—Ä—è–¥–∫–∞*"""
    
    # –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–Ω–µ –≤–∞–∂–µ–Ω –¥–ª—è –∑–∞—Ä–ø–ª–∞—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤)
    test_context = """[–ò—Å—Ç–æ—á–Ω–∏–∫ 1: –û–ø–ª–∞—Ç–∞ —Ç—Ä—É–¥–∞]
    –ó–∞—Ä–∞–±–æ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞ –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –¥–≤–∞ —Ä–∞–∑–∞ –≤ –º–µ—Å—è—Ü. –°—Ä–æ–∫–∏ –≤—ã–ø–ª–∞—Ç—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö.
    [–ò—Å—Ç–æ—á–Ω–∏–∫ 2: –î—Ä—É–≥–æ–π –¥–æ–∫—É–º–µ–Ω—Ç]
    –†–∞–±–æ—á–∏–π –¥–µ–Ω—å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 8 —á–∞—Å–æ–≤. –ü—Ä–µ–º–∏—è 100 —Ä—É–±."""
    
    all_passed = True
    
    for i, question in enumerate(salary_questions, 1):
        print(f"\nüß™ –¢–µ—Å—Ç {i}: '{question}'")
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º extract_key_information
        result = extract_key_information(test_context, question)
        
        if result == expected_response:
            print("‚úÖ extract_key_information: –ü–†–ê–í–ò–õ–¨–ù–û")
        else:
            print("‚ùå extract_key_information: –û–®–ò–ë–ö–ê")
            if result is None:
                print("–ü–æ–ª—É—á–µ–Ω–æ: None")
            else:
                print(f"–ü–æ–ª—É—á–µ–Ω–æ: {result[:100]}...")
            all_passed = False
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º extract_specific_data_patterns (–¥–æ–ª–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å None)
        specific_result = extract_specific_data_patterns(test_context, question)
        
        if specific_result is None:
            print("‚úÖ extract_specific_data_patterns: –ü–†–ê–í–ò–õ–¨–ù–û (None)")
        else:
            print("‚ùå extract_specific_data_patterns: –û–®–ò–ë–ö–ê (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å None)")
            print(f"–ü–æ–ª—É—á–µ–Ω–æ: {specific_result}")
            all_passed = False
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º create_direct_answer
        direct_result = create_direct_answer(question, "–ª—é–±–æ–π —Ç–µ–∫—Å—Ç", "–ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ")
        
        if direct_result == expected_response:
            print("‚úÖ create_direct_answer: –ü–†–ê–í–ò–õ–¨–ù–û")
        else:
            print("‚ùå create_direct_answer: –û–®–ò–ë–ö–ê")
            print(f"–ü–æ–ª—É—á–µ–Ω–æ: {direct_result[:100]}...")
            all_passed = False
        
        print("-" * 70)
    
    return all_passed

def test_admin_keyboard():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∞—Ç—É—Å—É —Å–∏—Å—Ç–µ–º—ã"""
    print("\nüîê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∞—Ç—É—Å—É —Å–∏—Å—Ç–µ–º—ã:")
    print("=" * 70)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    regular_keyboard = create_main_keyboard(123456789)
    regular_buttons = [button.text for row in regular_keyboard.inline_keyboard for button in row]
    
    print(f"üë§ –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (ID: 123456789)")
    print(f"üìã –ö–Ω–æ–ø–∫–∏: {regular_buttons}")
    
    if "üè• –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã" not in regular_buttons:
        print("‚úÖ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã —Å–∫—Ä—ã—Ç –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –ü–†–ê–í–ò–õ–¨–ù–û")
        regular_test_passed = True
    else:
        print("‚ùå –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –≤–∏–¥–µ–Ω –æ–±—ã—á–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: –û–®–ò–ë–ö–ê")
        regular_test_passed = False
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    admin_keyboard = create_main_keyboard(429336806)
    admin_buttons = [button.text for row in admin_keyboard.inline_keyboard for button in row]
    
    print(f"\nüëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (ID: 429336806)")
    print(f"üìã –ö–Ω–æ–ø–∫–∏: {admin_buttons}")
    
    if "üè• –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã" in admin_buttons:
        print("‚úÖ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –≤–∏–¥–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É: –ü–†–ê–í–ò–õ–¨–ù–û")
        admin_test_passed = True
    else:
        print("‚ùå –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã —Å–∫—Ä—ã—Ç –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: –û–®–ò–ë–ö–ê")
        admin_test_passed = False
    
    print("-" * 70)
    
    return regular_test_passed and admin_test_passed

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ï–î–ò–ù–û–ì–û –§–û–†–ú–ê–¢–ê –û–¢–í–ï–¢–û–í")
    print("=" * 80)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ –æ –∑–∞—Ä–ø–ª–∞—Ç–µ
    salary_tests_passed = test_unified_salary_responses()
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∞—Ç—É—Å—É —Å–∏—Å—Ç–µ–º—ã
    admin_tests_passed = test_admin_keyboard()
    
    print(f"\nüìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:")
    print("=" * 80)
    print(f"üí∞ –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞—Ä–ø–ª–∞—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {'‚úÖ –ü–†–û–ô–î–ï–ù' if salary_tests_passed else '‚ùå –ü–†–û–í–ê–õ–ï–ù'}")
    print(f"üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∞—Ç—É—Å—É: {'‚úÖ –ü–†–û–ô–î–ï–ù' if admin_tests_passed else '‚ùå –ü–†–û–í–ê–õ–ï–ù'}")
    
    if salary_tests_passed and admin_tests_passed:
        print("\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!")
        print("‚úÖ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –µ–¥–∏–Ω—ã–º —Å—Ç–∏–ª–µ–º –æ—Ç–≤–µ—Ç–æ–≤")
    else:
        print("\n‚ùå –ù–ï–ö–û–¢–û–†–´–ï –¢–ï–°–¢–´ –ü–†–û–í–ê–õ–ï–ù–´")
        print("üîß –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞")

if __name__ == "__main__":
    load_dotenv()
    main() 