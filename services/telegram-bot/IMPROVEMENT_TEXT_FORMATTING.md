# –£–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –¥–ª—è Telegram

## üìä –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ Telegram –±–æ—Ç–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

### ‚ùå –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **LaTeX —Ñ–æ—Ä–º—É–ª—ã** - –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è Telegram –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ —Å—ã—Ä–æ–π –∫–æ–¥
2. **–î–≤–æ–π–Ω—ã–µ —Ç–æ—á–∫–∏ –≤ –Ω—É–º–µ—Ä–∞—Ü–∏–∏** (1.., 2..) - –≤—ã–≥–ª—è–¥—è—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–†–∞–∑–ª–∏—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã —Å–ø–∏—Å–∫–æ–≤** (-, ‚Äî, ‚Äì) - –Ω–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
4. **–ü–ª–æ—Ö–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª** - —Å–ª–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π** - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–ª–∏–≤–∞—é—Ç—Å—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º

### üìù –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:
```
### –§–æ—Ä–º—É–ª—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–µ–º–∏–∏:
1.. –†–∞—Å—á–µ—Ç –º–µ—Å—è—á–Ω–æ–π –ø—Ä–µ–º–∏–∏:
\\[
\\text{–†–∞–∑–º–µ—Ä –ø—Ä–µ–º–∏–∏} = \\text{–ë–∞–∑–æ–≤–æ–µ} \\times \\text{–ü—Ä–æ—Ü–µ–Ω—Ç}
\\]

ÔøΩÔøΩ **–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**
```

## üîß –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `format_response_for_telegram()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

#### 1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ LaTeX —Ñ–æ—Ä–º—É–ª**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `\\[...\\]` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Telegram
- **–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∞ –Ω–∞ —á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Å —ç–º–æ–¥–∑–∏ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º
```python
# –ë—ã–ª–æ: \\[\\text{–†–∞–∑–º–µ—Ä –ø—Ä–µ–º–∏–∏} = \\text{–ë–∞–∑–æ–≤–æ–µ}\\]
# –°—Ç–∞–ª–æ: üìã `**–†–∞–∑–º–µ—Ä –ø—Ä–µ–º–∏–∏** = –ë–∞–∑–æ–≤–æ–µ`
```

#### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω—É–º–µ—Ä–∞—Ü–∏–∏**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `1..`, `2..` –≤—ã–≥–ª—è–¥—è—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∞ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –Ω—É–º–µ—Ä–∞—Ü–∏—é `1.`, `2.`

#### 3. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `###` –ø–ª–æ—Ö–æ –≤–∏–¥–Ω—ã –≤ Telegram
- **–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∞ –Ω–∞ `üî∑ **–ó–∞–≥–æ–ª–æ–≤–æ–∫:**`

#### 4. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –†–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (-, ‚Äî, ‚Äì)
- **–†–µ—à–µ–Ω–∏–µ**: –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã `‚Ä¢`

#### 5. **–£–ª—É—á—à–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª**
- **–†–∞–∑–±–∏–≤–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫** –Ω–∞ —á–∏—Ç–∞–µ–º—ã–µ —á–∞—Å—Ç–∏
- **–í—ã–¥–µ–ª–µ–Ω–∏–µ –≤ –∫–æ–¥** –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- **–ü–µ—Ä–µ–Ω–æ—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤** –Ω–∞ –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏

#### 6. **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**
- **–í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∏–Ω–∏–∏** `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ`

## üî¨ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```python
def format_response_for_telegram(text: str) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Telegram
    """
    # 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ LaTeX —Ñ–æ—Ä–º—É–ª
    # 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω—É–º–µ—Ä–∞—Ü–∏–∏
    # 3. –£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    # 4. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤
    # 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª
    # 6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π
```

### Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
- **LaTeX**: `r'\\\\?\[([^\\]+?)\\\\?\]'`
- **–ù—É–º–µ—Ä–∞—Ü–∏—è**: `r'(\d+)\.\.'`
- **–ó–∞–≥–æ–ª–æ–≤–∫–∏**: `r'^###\s*(.+?):'`
- **–°–ø–∏—Å–∫–∏**: `r'^(\s*)[‚Äî‚Äì]\s'`
- **–ò—Å—Ç–æ—á–Ω–∏–∫–∏**: `r'(üìö\s*\*\*–ò—Å—Ç–æ—á–Ω–∏–∫–∏:\*\*)'`

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–∞:
```python
# –í question_handler
if response_text:
    formatted_response = format_response_for_telegram(response_text)
    await message.answer(formatted_response, parse_mode="Markdown")
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç—ã:
1. **test_latex_formulas()** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ LaTeX
2. **test_list_formatting()** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–∏—Å–∫–æ–≤ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
3. **test_long_formulas()** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª
4. **test_sources_formatting()** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π
5. **test_complex_example()** - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ **LaTeX —Ñ–æ—Ä–º—É–ª—ã** - –ü–†–û–ô–î–ï–ù
- ‚úÖ **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤** - –ü–†–û–ô–î–ï–ù
- ‚úÖ **–î–ª–∏–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã** - –ü–†–û–ô–î–ï–ù
- ‚úÖ **–ò—Å—Ç–æ—á–Ω–∏–∫–∏** - –ü–†–û–ô–î–ï–ù
- ‚úÖ **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä** - –ü–†–û–ô–î–ï–ù

**–£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 100%**

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### üë§ –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- **–õ—É—á—à–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å** - —á–µ—Ç–∫–æ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü–æ–Ω—è—Ç–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã** - –≤–º–µ—Å—Ç–æ LaTeX –∫–æ–¥–∞
- **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
- **–í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** - —á–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã —Å–µ–∫—Ü–∏–π

### ü§ñ –î–ª—è —Å–∏—Å—Ç–µ–º—ã:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Telegram** - —É—á–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ regex

## üìù –ü—Ä–∏–º–µ—Ä—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
```
### –§–æ—Ä–º—É–ª—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–µ–º–∏–∏:
1.. –†–∞—Å—á–µ—Ç –º–µ—Å—è—á–Ω–æ–π –ø—Ä–µ–º–∏–∏:
\\[
\\text{–†–∞–∑–º–µ—Ä –ø—Ä–µ–º–∏–∏} = \\text{–ë–∞–∑–æ–≤–æ–µ} \\times \\text{–ü—Ä–æ—Ü–µ–Ω—Ç}
\\]

üìö **–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**
1. –î–æ–∫—É–º–µ–Ω—Ç
```

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
```
üî∑ **–§–æ—Ä–º—É–ª—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–µ–º–∏–∏:**

1. –†–∞—Å—á–µ—Ç –º–µ—Å—è—á–Ω–æ–π –ø—Ä–µ–º–∏–∏:

üìã `**–†–∞–∑–º–µ—Ä –ø—Ä–µ–º–∏–∏** = –ë–∞–∑–æ–≤–æ–µ √ó –ü—Ä–æ—Ü–µ–Ω—Ç`

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìö **–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**
1. –î–æ–∫—É–º–µ–Ω—Ç
```

## üöÄ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ
- ‚úÖ –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –≤ `bot/handlers.py`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ `question_handler`
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é
1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –æ–ø—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –≤—ã–±–æ—Ä—É
3. **–ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
4. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** - —É—á–µ—Ç –ø–æ–∂–µ–ª–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û**  
**–î–∞—Ç–∞:** 2025-06-02  
**–í–µ—Ä—Å–∏—è:** 1.0 